{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="controls">
        <h2>–õ—é–¥–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h2>
        <a href="{{ url_for('add_person') }}" class="btn">–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</a>
    </div>
    

    <div class="tree-wrapper">
    <div class="tree-controls">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomIn()">+</button>
            <button class="zoom-btn" onclick="zoomOut()">-</button>
            <button class="reset-btn" onclick="resetView()">‚ü≥</button>
        </div>
        
        <div class="pan-controls">
            <button class="pan-btn up" onclick="panUp()">‚Üë</button>
            <div class="horizontal-controls">
                <button class="pan-btn left" onclick="panLeft()">‚Üê</button>
                <button class="pan-btn center" onclick="resetView()">‚óã</button>
                <button class="pan-btn right" onclick="panRight()">‚Üí</button>
            </div>
            <button class="pan-btn down" onclick="panDown()">‚Üì</button>
        </div>
    </div>
    
    <div class="tree-container" id="treeContainer">
        {% for person in persons %}
        <div class="person-node"
            style="left: {{ person.x }}px; top: {{ person.y }}px;"
            data-person-id="{{ person.id }}">
            <div class="person-circle">
                {{ person.first_name[0] if person.first_name else '?' }}{{ person.second_name[0] if person.second_name else '?' }}
            </div>
            <div class="person-info">
                <span class="person-name">{{ person.second_name }} {{ person.first_name }}</span>
                {% if person.third_name %}
                <span class="person-patronymic">{{ person.third_name }}</span>
                {% endif %}
            </div>
            <button class="edit-btn" onclick="openModal({{ person.id }}, event)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        {% endfor %}
    </div>
</div>

<div class="search-controls">
    <form id="searchForm" class="search-form" onsubmit="searchPerson(event)">
        <div class="form-row">
            <div class="form-group">
                <label for="searchLastName">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" id="searchLastName" name="last_name" 
                       placeholder="–§–∞–º–∏–ª–∏—è" class="form-input">
            </div>
            
            <div class="form-group">
                <label for="searchFirstName">–ò–º—è</label>
                <input type="text" id="searchFirstName" name="first_name" 
                       placeholder="–ò–º—è" class="form-input">
            </div>
            
            <div class="form-group">
                <label for="searchPatronymic">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                <input type="text" id="searchPatronymic" name="patronymic" 
                       placeholder="–û—Ç—á–µ—Å—Ç–≤–æ" class="form-input">
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="search-btn">
                <span class="search-icon">üîç</span>
                –ù–∞–π—Ç–∏
            </button>
            <button type="button" class="clear-btn" onclick="clearSearch()">
                <span class="clear-icon">‚úï</span>
                –û—á–∏—Å—Ç–∏—Ç—å
            </button>
        </div>
    </form>
</div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="personModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h2>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <form id="personForm" class="modal-form">
            <input type="hidden" id="personId" name="person_id">
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section">
                <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="birthDate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <input type="date" id="birthDate" name="birth_date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="birthPlace">–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <input type="text" id="birthPlace" name="birth_place" class="form-input" placeholder="–ì–æ—Ä–æ–¥, —Å—Ç—Ä–∞–Ω–∞">
                    </div>
                    <div class="form-group">
                        <label>–ü–æ–ª *</label>
                        <div class="gender-selector">
                            <input type="hidden" id="gender" name="gender" required>
                            <button type="button" class="gender-btn male" data-gender="m" onclick="selectGender('m')">
                                ‚ôÇ –ú—É–∂—Å–∫–æ–π
                            </button>
                            <button type="button" class="gender-btn female" data-gender="f" onclick="selectGender('f')">
                                ‚ôÄ –ñ–µ–Ω—Å–∫–∏–π
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –†–æ–¥–∏—Ç–µ–ª–∏ -->
            <div class="form-section">
                <h3>–†–æ–¥–∏—Ç–µ–ª–∏</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>–ú–∞—Ç—å</label>
                        <div class="parent-selector">
                            <span id="motherName">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</span>
                            <button type="button" class="btn-select" onclick="openParentSelector('mother')">–í—ã–±—Ä–∞—Ç—å</button>
                            <button type="button" class="btn-clear" onclick="clearParent('mother')">‚úï</button>
                        </div>
                        <input type="hidden" id="motherId" name="mother_id">
                    </div>
                    
                    <div class="form-group">
                        <label>–û—Ç–µ—Ü</label>
                        <div class="parent-selector">
                            <span id="fatherName">–ù–µ –≤—ã–±—Ä–∞–Ω</span>
                            <button type="button" class="btn-select" onclick="openParentSelector('father')">–í—ã–±—Ä–∞—Ç—å</button>
                            <button type="button" class="btn-clear" onclick="clearParent('father')">‚úï</button>
                        </div>
                        <input type="hidden" id="fatherId" name="father_id">
                    </div>
                </div>
            </div>

            <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
            <div class="form-section">
                <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="form-group">
                    <label for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
                    <input type="number" id="age" name="age" class="form-input" min="0" max="150">
                </div>

                <div class="form-group">
                    <label for="history">–ò—Å—Ç–æ—Ä–∏—è –∂–∏–∑–Ω–∏</label>
                    <textarea id="history" name="history" class="form-textarea" rows="3" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∂–∏–∑–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞..."></textarea>
                </div>

                <div class="form-group">
                    <label for="education">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</label>
                    <textarea id="education" name="education" class="form-textarea" rows="2" placeholder="–£—á–µ–±–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é..."></textarea>
                </div>

                <div class="form-group">
                    <label for="work">–ú–µ—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã</label>
                    <textarea id="work" name="work" class="form-textarea" rows="2" placeholder="–ú–µ—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é..."></textarea>
                </div>

                <div class="form-row">

                    <div class="form-group">
                        <label for="deathDate">–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏</label>
                        <input type="date" id="deathDate" name="death_date" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="deathPlace">–ú–µ—Å—Ç–æ —Å–º–µ—Ä—Ç–∏</label>
                        <input type="text" id="deathPlace" name="death_place" class="form-input" placeholder="–ì–æ—Ä–æ–¥, —Å—Ç—Ä–∞–Ω–∞">
                    </div>
                </div>

            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–æ–¥–∏—Ç–µ–ª—è -->
<div id="parentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>–í—ã–±–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è</h2>
            <span class="close" onclick="closeParentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <input type="text" id="parentSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." class="search-input">
            <div class="parents-list" id="parentsList">
                <!-- –°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
            </div>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeParentModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>


{% endblock %}